<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="d3/d3.js"></script>
		<script type="text/javascript" src="util.js"></script>
        <style type="text/css">
			div.bar {
				display: inline-block;
				width: 20px;
				height: 75px;	/* Gets overriden by D3-assigned height below */
				margin-right: 2px;
				background-color: teal;
			}
		</style>
    </head>
    <body>
        <script type="text/javascript">
			var teamNames= ["ATL", "BRK", "CHA", "CHI", "DAL", "GSW", "HOU", "IND", "LAC", "MEM", "MIA", "OKC", "POR", "SAS", "TOR", "WAS"]
			var colors= {"ATL":"#D21033", "BOS":"#05854C", "BRK":"#000000", "CHA":"#F26532", "CHH":"#25799A", "CHI":"#D4001F", "CLE":"#9F1425", "DAL":"#006AB5", "DEN":"#4393D1", "DET":"#006BB6", "GSW":"#FFC33C", "HOU":"#CC0000", "IND":"#FFC225", "LAC":"#EE2944", "LAL":"#4A2583", "MEM":"#85A2C6", "MIA":"#B62630", "MIL":"#00330A", "MIN":"#EFEFEF", "NJN":"#002258", "NOH":"#0095CA", "NYK":"#2E66B2", "OKC":"#0075C1", "ORL":"#077ABD", "PHI":"#C7974D", "PHO":"#FF7A31", "POR":"#E1393E", "SAS":"#BEC8C9", "SAC":"#743389", "SEA":"#19542D", "TOR":"#CD1041", "UTA":"#448CCE", "WAS":"#004874"}
            //Width and height
            var w= 70*16+10;
            var h= 1000;
            var mainR= w/12; //radius of main circle
            var distScale= 150
			var zoomRad= w/8;
			var offset= 15; 
			
			//Create SVG element
			var svg= d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
						
			function setTeamOrbit(dat) {
				var name= dat.team;
				var neighbors= dat.neighbors;
				
				x= getDistBounds(neighbors);
				max= x[0];
				min= x[1];
				diff= max-min; //used when rescaling neighbor distance
				
			
				//set properties and event handlers of each circle in orbit
				svg.selectAll("g")
					.data(neighbors)
					.select("circle")
					.attr("cx", function(d,i) {
							return w/2 + (offset + mainR + ((d.dist-min)/(max-min))*distScale)*Math.cos(2*i*Math.PI/neighbors.length);
						})
					.attr("cy", function(d,i) {
							return h/2 - (offset + mainR + ((d.dist-min)/(max-min))*distScale)*Math.sin(2*i*Math.PI/neighbors.length);
						})
					.attr("r", function(d) {
							return d.wins*10+10;
						})
					.attr("fill", function(d,i) {
							return (d.name in colors) ? colors[d.name] : "#000000";
						})
					.moveToFront()
					.on("mouseover",function() {
							color= d3.select(this).attr("fill");
							d3.select(this).attr("stroke",d3.rgb(color).darker(1.5));
							d3.select(this).attr("stroke-width","5");
						})
					.on("mouseout",function() {
							d3.select(this).attr("stroke-width","0");
						})
					.on("click", function() {
							resize(d3.select(this.parentNode));
						});
					
				//add text to each group, set properties and event handler
				svg.selectAll("g")
					.data(neighbors)
					.select("text")
					.attr("x", function(d,i) {
							return w/2 + (offset + mainR + ((d.dist-min)/(max-min))*distScale)*Math.cos(2*i*Math.PI/neighbors.length);
						})
					.attr("y", function(d,i) {
							return h/2 - (offset + mainR + ((d.dist-min)/(max-min))*distScale)*Math.sin(2*i*Math.PI/neighbors.length);
						})
					.attr("text-anchor", "middle")
					.attr("dominant-baseline","central")
					.attr("fill", "white")
					.attr("visibility","hidden")
					.text(function(d) { return teamText(d); })
					.on("click", function() {
							if(d3.select(this).attr("visibility")=="visible") {
								resize(d3.select(this.parentNode));
							}
						});		
						
			}
			//load and display neighbor data
			d3.json("data.json", function(teamAndNeighs) {
					
				//draw concentric axes
				/*svg.selectAll("ellipse")
					.data(x)
					.enter()
					.append("ellipse")
					.attr("cx",w/2)
					.attr("cy",h/2)
					.attr("r", function(d) {
								return offset + mainR + ((d-min)/(max-min))*distScale;
							})
					.attr("r", function(d) {
								return offset + mainR + ((d-min)/(max-min))*distScale;
							})
					.attr("fill","white")
					.attr("fill-opacity",0.0)
					.attr("stroke","#777777");*/			
					
				//Create main circle
				svg.append("clipPath")
						.attr("id","por")
						.append("ellipse")
						.attr("cx",w/2)
						.attr("cy",h/2)
						.attr("rx",mainR)
						.attr("ry",mainR);
				
				svg.append("image")
						.attr("x",w/2-179/2)
						.attr("y",h/2-167/2)
						.attr("xlink:href","por.jpg")
						.attr("clip-path","url(#por)")
						.attr("width",179)
						.attr("height",167);
					
				//team circles on top row of page
				svg.selectAll("circle")
					.data(teamAndNeighs)
					.enter()
					.append("circle")
					.attr("cx", function(d,i) {
								return 40 + 70*i;
							})
					.attr("cy", 80)
					.attr("r", function(d) {
								return 30;
							})
					.attr("fill", function(d) {
								return (d.team in colors) ? colors[d.team] : "#000000";
							})
					.attr("visibility","visible")
					.on("mouseover",function() {
									color= d3.select(this).attr("fill");
									d3.select(this).attr("stroke",d3.rgb(color).darker(1.5));
									d3.select(this).attr("stroke-width","5");
								})
					.on("mouseout",function() {
									d3.select(this).attr("stroke-width","0");
								})
					.on("click", function(d) {
									setTeamOrbit(d);
								});
									
				//create groups for neighbor circles (planets)
				for (i = 0; i < 16; i++) {
					var orbit= svg.append("g")
						.attr("class","orbit");
					orbit.append("circle");
					orbit.append("text");
				}
			});
        </script>
    </body>
</html>
