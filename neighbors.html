<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="d3/d3.js"></script>
		<script type="text/javascript" src="util.js"></script>
		<script type="text/javascript" src="view.js"></script>
        <style type="text/css">
			text {
				font-family: sans-serif;
				text-anchor: middle;  
			}
		</style>
    </head>
    <body>
        <script type="text/javascript">
			var teamNames= ["ATL", "BRK", "CHA", "CHI", "DAL", "GSW", "HOU", "IND", "LAC", "MEM", "MIA", "OKC", "POR", "SAS", "TOR", "WAS"]
			var colors= {"ATL":"#D21033", "BOS":"#05854C", "BRK":"#000000", "CHA":"#F26532", "CHH":"#25799A", "CHI":"#D4001F", "CLE":"#9F1425", "DAL":"#006AB5", "DEN":"#4393D1", "DET":"#006BB6", "GSW":"#FFC33C", "HOU":"#CC0000", "IND":"#FFC225", "LAC":"#EE2944", "LAL":"#4A2583", "MEM":"#85A2C6", "MIA":"#B62630", "MIL":"#00330A", "MIN":"#EFEFEF", "NJN":"#002258", "NOH":"#0095CA", "NYK":"#2E66B2", "OKC":"#0075C1", "ORL":"#077ABD", "PHI":"#C7974D", "PHO":"#FF7A31", "POR":"#E1393E", "SAS":"#BEC8C9", "SAC":"#743389", "SEA":"#19542D", "TOR":"#CD1041", "UTA":"#448CCE", "WAS":"#004874","HELP":"#d8d8f0"}
            //Width and height
            var w= 1200;
            var h= 590;
            var mainR= w/12; //radius of main circle
            var distScale= 150
			var zoomRad= w/8;
			var offset= 15;
			var leftPad= 50;
			var toggleClicked= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]; //used in keeping toggle circles highlighted
			var numAxes= 2;
			var toggleButtonDiam= 60;
			var toggleGroupWidth= 2.5*toggleButtonDiam + 2*leftPad;
			var imageSidelen= 200;
			var orbitCenterX= toggleGroupWidth+zoomRad+distScale+offset+mainR;
			var orbitCenterY= h/2;
			var minNeighRad= w/120;
			var winRadScale= w/120;
			var onHelp= true;
			
			//Create SVG element
			var svg= d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
			
			
			/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~AXES~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
						
			//create group for concentric axes
			var axes= svg.append("g")
						.attr("class", "axes")
			for (i=0; i<numAxes; i++) {
				axes.append("ellipse")
					.attr("class","axes")
					.attr("cx",orbitCenterX)
					.attr("cy",orbitCenterY)
			}
			formatAxes();
			
			
			
			/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~HELP SCREEN~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
			
			//group for help items
			help= svg.append("g")
					.attr("class","help")
					
			//paths for help text
			help.append("path")
				.attr("id","veryVerySimilar")
				.attr("stroke","none")
				.attr("fill","none")
				.attr("d", "M " + (orbitCenterX-offset-mainR) + " " + orbitCenterY + " " + "A " + mainR + " " + mainR + " 0 1 1 " + (orbitCenterX + offset + mainR) + " " + orbitCenterY)
			help.append("path")
				.attr("id","verySimilar")
				.attr("stroke","none")
				.attr("fill","none")
				.attr("d", "M " + (orbitCenterX-offset-mainR) + " " + orbitCenterY + " " + "A " + mainR + " " + mainR + " 0 1 1 " + (orbitCenterX + offset + mainR) + " " + orbitCenterY)
			help.append("text")
				.attr("fill","#999999")
				.attr("class","helpPath")
				.attr("font-size",distScale/8)
				.attr("dy",offset-distScale/4)
				.append("textPath")
				.attr("xlink:href","#veryVerySimilar")
				.attr("startOffset","50%")
				.text("VERY VERY SIMILAR TEAMS")
			help.append("text")
				.attr("class","helpPath")
				.attr("fill","#999999")
				.attr("font-size",distScale/8)
				.attr("dy",offset-3*distScale/4)
				.append("textPath")
				.attr("xlink:href","#verySimilar")
				.attr("startOffset","50%")
				.text("VERY SIMILAR TEAMS")
				
			//sun for help text
			help.append("circle")
				.attr("class","sun")
				.attr("cx",orbitCenterX)
				.attr("cy",orbitCenterY)
				.attr("r",mainR)
				.attr("fill",colors["HELP"])
			
		
			//load and display neighbor data
			d3.json("data.json", function(teamAndNeighs) {		
				
				
				
				/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~CENTRAL SUN~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
				
				//Create main circle
				sun= svg.append("g")
						.attr("class","sun")	
				sun.append("circle")
					.attr("class","sun")
					.attr("cx",orbitCenterX)
					.attr("cy",orbitCenterY)
					.attr("r",mainR)
					.attr("fill","none")
				sun.append("a")
					.attr("class","link")
					.append("text");
				for(i=0;i<5;i++) {
					sun.append("text")
						.attr("class","sun")
						.attr("fill","white")
				}
				
				
				
				/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~HELP BUTTON~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
				
				//help button
				helpButtonDiv= d3.select("body").append("div")
								.attr("id","fixed1")
								.style("top",toggleButtonDiam+"px")
								.style("right",toggleButtonDiam+"px")
								.style("width",toggleButtonDiam+"px")
								.style("height",toggleButtonDiam+"px")
								.style("position","fixed")
				helpButton= helpButtonDiv.append("svg")
										.attr("class","helpButton")
				
				helpButton.append("circle")
						.attr("class", "helpButton")
						.attr("cx",toggleButtonDiam/2)
						.attr("cy",toggleButtonDiam/2)
						.attr("r",toggleButtonDiam/2)
						.attr("fill", colors["HELP"])
						
				helpButton.on("mouseover",function() { //Add event handler to each GROUP (not each individual circle/text!)
								color= d3.select(this).select("circle").attr("fill");
								d3.select(this).select("circle").attr("stroke",d3.rgb(color).darker(1));
								d3.select(this).select("circle").attr("stroke-width","5");
							})
					.on("mouseout",function() {
									for(i=0; i<17; i++) {
										if(toggleClicked[i]==0) {
											d3.select(this).select("circle").attr("stroke-width","0");
										}
									}
								})
					.on("click", function(d,i) {
									toggleClicked[toggleClicked.length-1]= 1;
									unSelectToggles(toggleClicked.length-1);
									showHelp();
								});
				helpButton.append("text") //Add text to each group
					.attr("class","helpButton")
					.attr("x", toggleButtonDiam/2)
					.attr("y", toggleButtonDiam/2)
					.attr("font-size",toggleButtonDiam/4)
					.attr("font-family","sans-serif")
					.attr("dominant-baseline","central")
					.attr("fill", "white")
					.text("HELP");
				
				
				
				/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~TOGGLE~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
				
				//create left bar of 2014 playoff teams
				toggle= d3.select("body")
							.append("div")
							.style("top",5+"px")
							.style("left",0+"px")
							.style("height","100%")
							.style("width","20%")
							.style("position","fixed")
							.style("overflow","scroll")
							.append("svg")
							.attr("class","toggle")
							.attr("x",0)
							.attr("y",5)
							.attr("width", toggleGroupWidth)
							.attr("height", h);
				
				togTitleFontSize= 22;
				togConfFontSize= 18;
				confs= ["WEST","EAST"];
				toggle.append("text")
						.attr("fill","#999999")
						.text("2014 Playoff Teams")
						.attr("font-size", togTitleFontSize)
						.attr("x", toggleGroupWidth/2)
						.attr("y", togTitleFontSize)
						.attr("text-anchor","middle")
				for(i=0;i<confs.length;i++){
				toggle.append("text")
						.attr("fill","#999999")
						.text(confs[i])
						.attr("font-size", togConfFontSize)
						.attr("x", leftPad + toggleButtonDiam/2 + i*(3*toggleButtonDiam/2))
						.attr("y", togTitleFontSize + 2*togConfFontSize)
						.attr("text-anchor","middle")
				}
				
				toggleButton= toggle.selectAll("g.toggleButton") //Add groups for each toggle button
							.data(teamAndNeighs)
							.enter()
							.append("g")
							.attr("class","toggleButton");					
				toggleButton.append("circle") //Add circle to each group
					.attr("class","toggleButton")
					.attr("cx", function(d,i) {
								if (i<8) {
									return toggleGroupWidth - leftPad - toggleButtonDiam/2;
								}
								else {
									return leftPad + toggleButtonDiam/2;
								}
							})
					.attr("cy", function(d,i) {
							return 2.5*togTitleFontSize + 2.5*togConfFontSize + (toggleButtonDiam+5)*(i%8);
						})
					.attr("r", toggleButtonDiam/2)
					.attr("fill", function(d) {
								return (d.team in colors) ? colors[d.team] : "#000000";
							});	
				toggleButton.append("text") //Add text to each group
					.attr("class","toggleButton")
					.attr("id","text")
					.attr("x", function(d,i) {
								if (i<8) {
									return toggleGroupWidth - leftPad - toggleButtonDiam/2;
								}
								else {
									return leftPad + toggleButtonDiam/2;
								}
							})
					.attr("y", function(d,i) {
							return 2.5*togTitleFontSize + 2.5*togConfFontSize + (toggleButtonDiam+5)*(i%8);
						})
					.attr("font-size",toggleButtonDiam/4)
					.attr("font-family","sans-serif")
					.attr("dominant-baseline","central")
					.attr("fill", "white")
					.text(function(d) { return d.team; });	
				toggleButton.on("mouseover",function() { //Add event handler to each GROUP (not each individual circle/text!)
									color= d3.select(this).select("circle").attr("fill");
									d3.select(this).select("circle").attr("stroke",d3.rgb(color).darker(1));
									d3.select(this).select("circle").attr("stroke-width","5");
								})
						.on("mouseout",function(d,i) {
										if(toggleClicked[i]==0) {
											d3.select(this).select("circle").attr("stroke-width","0");
										}
									})
						.on("click", function(d,i) {
										unSelectToggles(i);
										toggleClicked[i]= 1;
										setOrbit(d);
										setZoomText(d);
									});
				
				
				
				/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~NEIGHBORS~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
				
				//create groups for neighbor circles (planets)
				for (i = 0; i < 16; i++) {
					var orbGroup= svg.append("g")
									.attr("class","orbit");
					orbGroup.append("circle");
					txtGroup= orbGroup.append("svg");
					
					//Team name with link
					txtGroup.append("a")
							.attr("class","link")
							.append("text");
							
					//Appending rest of text
					for (j=0; j<7; j++) {
						txtGroup.append("text");
					}
				}
			});
        </script>
    </body>
</html>