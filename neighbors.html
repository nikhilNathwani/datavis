<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="d3/d3.js"></script>
		<script type="text/javascript" src="util.js"></script>
        <style type="text/css">
			div.bar {
				display: inline-block;
				width: 20px;
				height: 75px;	/* Gets overriden by D3-assigned height below */
				margin-right: 2px;
				background-color: teal;
			}
			#text {
				font-family: sans-serif;
			}
		</style>
    </head>
    <body>
        <script type="text/javascript">
			var teamNames= ["ATL", "BRK", "CHA", "CHI", "DAL", "GSW", "HOU", "IND", "LAC", "MEM", "MIA", "OKC", "POR", "SAS", "TOR", "WAS"]
			var colors= {"ATL":"#D21033", "BOS":"#05854C", "BRK":"#000000", "CHA":"#F26532", "CHH":"#25799A", "CHI":"#D4001F", "CLE":"#9F1425", "DAL":"#006AB5", "DEN":"#4393D1", "DET":"#006BB6", "GSW":"#FFC33C", "HOU":"#CC0000", "IND":"#FFC225", "LAC":"#EE2944", "LAL":"#4A2583", "MEM":"#85A2C6", "MIA":"#B62630", "MIL":"#00330A", "MIN":"#EFEFEF", "NJN":"#002258", "NOH":"#0095CA", "NYK":"#2E66B2", "OKC":"#0075C1", "ORL":"#077ABD", "PHI":"#C7974D", "PHO":"#FF7A31", "POR":"#E1393E", "SAS":"#BEC8C9", "SAC":"#743389", "SEA":"#19542D", "TOR":"#CD1041", "UTA":"#448CCE", "WAS":"#004874","HELP":"#6b8323"}
            //Width and height
            var w= 1200;
            var h= 900;
            var mainR= w/12; //radius of main circle
            var distScale= 150
			var zoomRad= w/8;
			var offset= 15;
			var leftPad= 30;
			var toggleClicked= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]; //used in keeping toggle circles highlighted
			var numAxes= 3;
			var toggleButtonDiam= 60;
			var toggleGroupWidth= 2*toggleButtonDiam + 2*leftPad + 10;
			var imageSidelen= 200;
			var orbitCenterX= toggleGroupWidth+zoomRad+distScale+offset+mainR;
			var minNeighRad= w/120;
			var winRadScale= w/120;
			
			//Create SVG element
			var svg= d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
						
			//create group for concentric axes
			var axes= svg.append("g")
						.attr("class", "axes")
			for (i=0; i<numAxes; i++) {
				axes.append("ellipse")
					.attr("class","axes")
					.attr("cx",orbitCenterX)
					.attr("cy",h/2)
			}
		
			//load and display neighbor data
			d3.json("data.json", function(teamAndNeighs) {		
					
				//Create main circle
				sun= svg.append("g")
						.attr("class","sun")	
				sun.append("clipPath")
						.attr("class","sun")
						.attr("id","sun")
						.append("ellipse")
						.attr("cx",orbitCenterX)
						.attr("cy",h/2)
						.attr("rx",mainR)
						.attr("ry",mainR);
				sun.append("image")
						.attr("class","sun")
						.attr("clip-path","url(#sun)")
						.attr("x",orbitCenterX-mainR)
						.attr("y",h/2-mainR)
						.attr("width",imageSidelen)
						.attr("height",imageSidelen);
				
				
				//help button
				help= svg.append("g")
						.attr("class","help")
				help.append("circle")
						.attr("class", "help")
						.attr("cx",3*w/4)
						.attr("cy",h/4)
						.attr("r",toggleButtonDiam/2)
						.attr("fill", colors["HELP"])
						
				help.on("mouseover",function() { //Add event handler to each GROUP (not each individual circle/text!)
								color= d3.select(this).select("circle").attr("fill");
								d3.select(this).select("circle").attr("stroke",d3.rgb(color).darker(1));
								d3.select(this).select("circle").attr("stroke-width","5");
							})
					.on("mouseout",function() {
									for(i=0; i<17; i++) {
										if(toggleClicked[i]==0) {
											d3.select(this).select("circle").attr("stroke-width","0");
										}
									}
								})
					.on("click", function(d,i) {
									toggleClicked[toggleClicked.length-1]= 1;
									showHelp();
								});
				help.append("text") //Add text to each group
					.attr("class","help")
					.attr("x", 3*w/4)
					.attr("y", h/4)
					.attr("text-anchor", "middle")
					.attr("font-size",toggleButtonDiam/4)
					.attr("font-family","sans-serif")
					.attr("dominant-baseline","central")
					.attr("fill", "white")
					.text("HELP");
					
				//create left bar of 2014 playoff teams
				toggle= svg.selectAll("g.toggle") //Add groups for each toggle button
							.data(teamAndNeighs)
							.enter()
							.append("g")
							.attr("class","toggle");					
				toggle.append("circle") //Add circle to each group
					.attr("class","toggle")
					.attr("cx", function(d,i) {
								if (i<8) {
									return leftPad + toggleButtonDiam + leftPad + toggleButtonDiam/2;
								}
								else {
									return leftPad + toggleButtonDiam/2;
								}
							})
					.attr("cy", function(d,i) {
							return 200+(toggleButtonDiam+10)*(i%8);
						})
					.attr("r", toggleButtonDiam/2)
					.attr("fill", function(d) {
								return (d.team in colors) ? colors[d.team] : "#000000";
							});	
				toggle.append("text") //Add text to each group
					.attr("class","toggle")
					.attr("id","text")
					.attr("x", function(d,i) {
								if (i<8) {
									return leftPad + toggleButtonDiam + leftPad + toggleButtonDiam/2;
								}
								else {
									return leftPad + toggleButtonDiam/2;
								}
							})
					.attr("y", function(d,i) {
							return 200+(toggleButtonDiam+10)*(i%8);
						})
					.attr("text-anchor", "middle")
					.attr("font-size",toggleButtonDiam/4)
					.attr("font-family","sans-serif")
					.attr("dominant-baseline","central")
					.attr("fill", "white")
					.text(function(d) { return d.team; });	
				toggle.on("mouseover",function() { //Add event handler to each GROUP (not each individual circle/text!)
									color= d3.select(this).select("circle").attr("fill");
									d3.select(this).select("circle").attr("stroke",d3.rgb(color).darker(1));
									d3.select(this).select("circle").attr("stroke-width","5");
								})
						.on("mouseout",function(d,i) {
										if(toggleClicked[i]==0) {
											d3.select(this).select("circle").attr("stroke-width","0");
										}
									})
						.on("click", function(d,i) {
										toggleOrbit(d);
										toggleClicked[i]= 1;
									});
												
				//create groups for neighbor circles (planets)
				for (i = 0; i < 16; i++) {
					var orbGroup= svg.append("g")
									.attr("class","orbit");
					orbGroup.append("circle");
					txtGroup= orbGroup.append("svg");
					
					//Team name with link
					txtGroup.append("a")
							.attr("class","link")
							.append("text");
							
					//Appending rest of text
					for (j=0; j<7; j++) {
						txtGroup.append("text");
					}
				}
			});
        </script>
    </body>
</html>