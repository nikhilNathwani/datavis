<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="d3/d3.js"></script>
        <style type="text/css">
			text {
			    font-family: Verdana;
			}
			.axis path,
			.axis line {
			    fill: none;
			    stroke: black;
			    shape-rendering: crispEdges;
			}
		</style>
    </head>
    <body>
        <script type="text/javascript">
            //Width and height
            var w= 2500;
            var h= 1200;
			var margin=20;
			var rectHeight= h/50;
			var rad= 2*rectHeight/9;
			var togRad= 25;
			var togPadY= 5;
			var playerTextPad= 5;
			var togSpace= 10;
			var togHeight= 4*(togRad+togPadY) + 40;
			var toggleClicked= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]; //used in keeping toggle circles highlighted
			
			var colors= {"ATL":"#D21033", "BOS":"#05854C", "BRK":"#000000", "CHA":"#F26532", "CHI":"#D4001F", "CLE":"#9F1425", "DAL":"#006AB5", "DEN":"#4393D1", "DET":"#006BB6", "GSW":"#FFC33C", "HOU":"#CC0000", "IND":"#FFC225", "LAC":"#EE2944", "LAL":"#4A2583", "MEM":"#85A2C6", "MIA":"#B62630", "MIL":"#00330A", "MIN":"#12397F", "NOP": "#091D4A", "NYK":"#2E66B2", "OKC":"#0075C1", "ORL":"#077ABD", "PHI":"#C7974D", "PHO":"#FF7A31", "POR":"#E1393E", "SAS":"#BEC8C9", "SAC":"#743389", "TOR":"#CD1041", "UTA":"#448CCE", "WAS":"#004874"}

			//Create SVG element
			var svg= d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
		
			//load and display win share data
			d3.json("eras.json", function(playerEras) {		
				eras= playerEras[0].eras;
				firstYear= eras[0].years[0];
				lastYear= 2014;
				graphStartX= (15*(2*togRad+togSpace))/2-(150+3*rad+2*rad*(2014-firstYear+1))/2
				numRects= 0;
				confFinals= playerEras[0].confFinal
				finalsLoss= playerEras[0].lossFinal
				champion= playerEras[0].champion


				playerGroups= svg.selectAll("g")
								.data(eras)
								.enter()
								.append("g")
								.attr("class","player")
								.attr("id",function(d) {return d.player;})
								.attr("background-color","blue")

				//Coloring the rows of the graph
				playerGroups.append("rect")
							.attr("x",graphStartX)
							.attr("y",function(d,i) {numRects += 1; return togHeight + rectHeight*i;})
							.attr("width",150+3*rad + 2*rad*(2014-firstYear))
							.attr("height",rectHeight)
							.attr("fill", function(d,i){return i%2==1 ? "#2B6689" : "#347CA5"})//"#F2EFFD"})
							.on("mouseover",function() {
								d3.select(this).attr("fill",d3.rgb("#ffeef5").darker(1));
							})
							.on("mouseout", function(d,i){
								d3.select(this).attr("fill", i%2==1 ? "#2B6689" : "#347CA5");//"#F2EFFD");
							});
				
				//Player names
				playerGroups.append("text")
							.attr("class","playerName")
							.attr("id",function(d) {return d.player;})
							.attr("x",graphStartX + playerTextPad)
							.attr("y",function(d,i) {return togHeight + rectHeight*i + rectHeight/2;})
							.attr("dominant-baseline","central")
							.attr("font-size",3*rectHeight/5)
							.attr("fill","white")
							.text(function(d) {return d.player;})
				
				//Dots on graph 
				playerGroups.selectAll("circle")
							.data(function(d) {return d.years;})
							.enter()
							.append("circle")
							.attr("class","winShare")
							.attr("id",function(d) {return d;})
							.attr("fill", function(d) {
								if(confFinals.indexOf(d) != -1) {
									return "#b87333"
								}
								else if(finalsLoss.indexOf(d) != -1) {
									return "#c0c0c0"
								}
								else if(champion.indexOf(d) != -1) {
									return "#daa530"
								}
								else {
									return "white"; //"#555555";
								}
							})//colors[playerEras[0].team])
							.attr("r", rad)
							.attr("cx",function(d) {
								return graphStartX+150+rad+(parseInt(d)-firstYear)*2*rad;
							})
							.attr("cy",function(d,i,j) {
									//j gets index of parent group amongst its sibling groups!
									return togHeight + rectHeight*j + rectHeight/2;
								})

				var xScale = d3.scale.linear()
                     .domain([firstYear, 2014])
                     .range([0, (2014-firstYear)*2*rad]);

				var xAxisTop = d3.svg.axis()
								.scale(xScale)
								.ticks((2014-firstYear)/4)
								.orient("bottom")
								.tickFormat(d3.format("d"));
				
				var xAxisBottom = d3.svg.axis()
									.scale(xScale)
									.ticks((2014-firstYear)/4)
									.orient("top")
									.tickFormat(d3.format("d"));

				svg.append("g")
				    .attr("class", "axis")  //Assign "axis" class
				    .attr("transform", "translate("+(graphStartX+150+rad)+"," + (togHeight + numRects*rectHeight) + ")")
				    .call(xAxisTop);
				
				svg.append("g")
				    .attr("class", "axis")  //Assign "axis" class
				    .attr("transform", "translate("+(graphStartX+150+rad)+"," + togHeight + ")")
				    .call(xAxisBottom);
				

				/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~TOGGLE~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
				//Unselect all toggles (and help button) except that at index "except" (help is index 16)
				function unSelectToggles(except) {
					var circs= svg.select("svg.toggle")
								.selectAll("g.toggleButton");
					circs.select("circle")
						.attr("stroke-width",function(d,i){
							toggleClicked[i]= 0;
							return except==i ? 5 : 0;
						})
				}

				//create left bar of 2014 playoff teams
				toggle= svg.append("svg")
							.attr("class","toggle")
							.attr("x",0)
							.attr("y",togPadY)
							.attr("width", 30*(2*togRad+togSpace))
							.attr("height", togHeight);
				
				toggleButton= toggle.selectAll("g.toggleButton") //Add groups for each toggle button
							.data(Object.keys(colors))
							.enter()
							.append("g")
							.attr("class","toggleButton");					
				toggleButton.append("circle") //Add circle to each group
					.attr("class","toggleButton")
					.attr("cx", function(d,i) {
								return togRad + (i%15)*(2*togRad+togSpace);
							})
					.attr("cy", function(d,i){
						return i<15 ? togPadY + togRad : 3*togPadY + 3*togRad
					})
					.attr("r", togRad)
					.attr("fill", function(d) {
								return (d in colors) ? colors[d] : "#000000";
							});	
				toggleButton.append("text") //Add text to each group
					.attr("class","toggleButton")
					.attr("id","text")
					.attr("x", function(d,i) {
								return togRad + (i%15)*(2*togRad+togSpace);
							})
					.attr("y", function(d,i){
						return i<15 ? togPadY + togRad : 3*togPadY + 3*togRad
					})
					.attr("font-size",togRad/2)
					.attr("font-family","sans-serif")
					.attr("text-anchor","middle")
					.attr("dominant-baseline","central")
					.attr("fill", "white")
					.text(function(d) { return d; });	
				toggleButton.on("mouseover",function() { //Add event handler to each GROUP (not each individual circle/text!)
									color= d3.select(this).select("circle").attr("fill");
									d3.select(this).select("circle").attr("stroke",d3.rgb(color).darker(1));
									d3.select(this).select("circle").attr("stroke-width","5");
								})
						.on("mouseout",function(d,i) {
										if(toggleClicked[i]==0) {
											d3.select(this).select("circle").attr("stroke-width","0");
										}
									})
						.on("click", function(d,i) {
										unSelectToggles(i);
										toggleClicked[i]= 1;
									});

			});
        </script>
    </body>
</html>